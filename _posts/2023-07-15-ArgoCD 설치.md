---
title: Helm으로 ArgoCD 설치
date: 2023-07-16 15:33:44 +09:00
categories: [devops-study, git]
tags: [git, gitlab, atlantis, gitops, terraform, iac]
image: /assets/img/posts/image-20230711012040124.png

---



작성 중...

<br>

https://argo-cd.readthedocs.io/en/stable/user-guide/helm/



kubectl create namespace argocd 

```bash
helm repo add argo https://argoproj.github.io/argo-helm
```



```bash
helm -n argocd install argocd argo/argo-cd
```



alb ingress 생성하기



argocd service 생성

```yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol-version: HTTP2 #This tells AWS to send traffic from the ALB using HTTP2. Can use GRPC as well if you want to leverage GRPC specific features
  labels:
    app: argogrpc
  name: argogrpc
  namespace: argocd
spec:
  ports:
  - name: "443"
    port: 443
    protocol: TCP
    targetPort: 8080
  selector:
    app.kubernetes.io/name: argocd-server
  sessionAffinity: None
  type: NodePort
```



argocd ingress 생성



argocd admin 생성

```null
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo
```

admin

pw : Ru7SwQkjTqPf3l5X



repo 추가

![image-20230716033240400](/Users/mzc01-ljyoon/Documents/blog/jjikin.github.io/assets/img/posts/image-20230716033240400.png)



argocd cli 설치

brew install argocd



argocd login argocd.jjikin.com



컨텍스트 확인

kubectl config get-contexts -o name



argocd에 클러스터 추가 -> 필요없음 argocd가 설치된 클러스터는 default로 확인됨

argocd cluster add arn:aws:eks:ap-northeast-2:371604478497:cluster/devops-eks-cluster

```shell
WARNING: This will create a service account `argocd-manager` on the cluster referenced by context `arn:aws:eks:ap-northeast-2:371604478497:cluster/devops-eks-cluster` with full cluster level privileges. Do you want to continue [y/N]? y
INFO[0004] ServiceAccount "argocd-manager" created in namespace "kube-system"
INFO[0004] ClusterRole "argocd-manager-role" created
INFO[0004] ClusterRoleBinding "argocd-manager-role-binding" created
INFO[0010] Created bearer token secret for ServiceAccount "argocd-manager"
Cluster 'https://BB5EE6979206B84A75A0FD164597447C.gr7.ap-northeast-2.eks.amazonaws.com' added
```



Application 생성

argocd app create eks --repo https://gitlab.jjikin.com/jjikin/devops.git --path . --dest-server https://kubernetes.default.svc --dest-namespace default

grpc 는  argocd CLI 사용 시 필요함



ArgoCD로 배포해야하는 리소스는?

- 애플리케이션(sock-shop)



sock







